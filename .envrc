#!/usr/bin/env bash

if ! has uv; then
	echo "uv is not installed"
	exit 1
fi

# Unset UV variables that cause issues when empty
unset UV_NO_SYNC UV_PYTHON UV_PYTHON_DOWNLOADS SOURCE_DATE_EPOCH

watch_file pyproject.toml
watch_file uv.lock

if [ ! -d .venv ]; then
	uv venv
fi

# Sync with the appropriate FAISS backend (cpu or gpu)
uv sync --all-groups

source .venv/bin/activate
